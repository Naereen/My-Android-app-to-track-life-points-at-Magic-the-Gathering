@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
	input[type='number']::-webkit-inner-spin-button,
	input[type='number']::-webkit-outer-spin-button {
		-webkit-appearance: none;
		margin: 0;
	}

	:root {
		/* On définit des variables par défaut au cas où env() ne soit pas supporté */
		--safe-area-inset-top: 0px;
		--safe-area-inset-bottom: 0px;
	}

	/* Ensure the app spans the full viewport and remove default body margins */
	html,
	body,
	#svelte {
		height: 100%;
		width: 100%;
		margin: 0;
		/* Set default font size for the app */
		font-size: large;
	}

	body {
		/* On utilise les constantes fournies par le moteur de rendu de l'appareil */
		padding-top: env(safe-area-inset-top, var(--safe-area-inset-top, 0px));
		padding-bottom: env(safe-area-inset-bottom, var(--safe-area-inset-bottom, 0px));
		/* Assurez-vous que votre application ne dépasse pas */
		box-sizing: border-box;
	}

	/* Si rien ne marche, on ajoute une marge de sécurité standard pour Android uniquement quand on détecte que l'app est lancée via Capacitor */
	/* Correctif spécifique quand l'app tourne en natif sur Android */
	body.is-native.is-android {
		/* On ajoute une marge de sécurité arbitraire si env() ne répond pas */
		/* 48px est la hauteur standard de la barre de navigation Android */
		padding-bottom: 48px;

		/* On s'assure que le fond de l'app couvre cette nouvelle zone */
		background-color: #062911;
	}

	/* Si vous voulez être très précis et utiliser les variables d'environnement
	tout en ayant un "fallback" manuel : */
	body.is-native {
		padding-bottom: max(48px, env(safe-area-inset-bottom, var(--safe-area-inset-bottom, 0px)));
	}

	@media (max-width: 640px) {
		html {
			/* Smaller font size on small screens */
			font-size: medium;
		}
	}

	@media (max-width: 480px) {
		html {
			/* Much smaller font size on smaller screens */
			font-size: small;
		}
	}

	body {
		@apply bg-black;
		/* FIXME find the correct value to make the Capacitor native app work fine! */
		/* min-height: 100%; */
		max-height: 100%;
	}

	div .rotation-180 {
		transform: rotate(180deg);
	}

	div .rotation-90 {
		transform: rotate(90deg);
	}

	div .rotation-270 {
		transform: rotate(270deg);
	}

	@font-face {
		/* https://freefontsvault.com/beleren-font/ */
		font-family: 'Beleren2016';
		src: url('./Beleren2016-Bold.ttf') format('truetype');
		font-weight: normal;
		font-style: normal;
		font-display: swap;
	}
	:root {
		--font-beleren: 'Beleren2016', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
	}
	.beleren {
		font-family: var(--font-beleren);
	}

	/* Style for the active player: a golden glow around the card */
	.player--active {
		z-index: 50; /* above the background and overlay but below the content (content uses z-index:10) */
		box-shadow: 0 0 0 4px rgba(212,175,55,0.18), 0 0 30px rgba(212,175,55,0.6);
		animation: player-glow 1s ease-in-out infinite;
		/* keep rounded corners consistent with .rounded-2xl */
		border-radius: 1rem;
	}

	@keyframes player-glow {
		0% {
			box-shadow: 0 0 0 0 rgba(212,175,55,0.0), 0 0 10px rgba(212,175,55,0.2);
		}
		50% {
			box-shadow: 0 0 0 6px rgba(212,175,55,0.25), 0 0 40px rgba(212,175,55,1.0);
		}
		100% {
			box-shadow: 0 0 0 0 rgba(212,175,55,0.0), 0 0 10px rgba(212,175,55,0.2);
		}
	}

	/* Style for the active player and the timer is over: a red glow around the card */
	.player--active-timer-over {
		z-index: 50; /* above the background and overlay but below the content (content uses z-index:10) */
		box-shadow: 0 0 0 4px rgba(255,0,0,0.2), 0 0 30px rgba(255,0,0,0.4);
		animation: player-glow-timer-over 1s ease-in-out infinite;
		/* keep rounded corners consistent with .rounded-2xl */
		border-radius: 1rem;
	}

	@keyframes player-glow-timer-over {
		0% {
			box-shadow: 0 0 0 0 rgba(255,0,0,0.0), 0 0 10px rgba(255,0,0,0.2);
		}
		50% {
			box-shadow: 0 0 0 6px rgba(255,0,0,0.25), 0 0 40px rgba(255,0,0,1.0);
		}
		100% {
			box-shadow: 0 0 0 0 rgba(255,0,0,0.0), 0 0 10px rgba(255,0,0,0.2);
		}
	}

	.bg-rotated {
		position: relative;
		overflow: hidden;
		border-radius: inherit;
		display: flex;
		z-index: 5;
	}

	/* Pseudo-élément plus grand pour couvrir correctement après rotation */
	.bg-rotated::before, .bg-rotated::after {
		content: '';
		position: absolute;
		top: var(--bg-top, 50%);
		left: var(--bg-left, 50%);
		width: var(--bg-width, 100%);
		height: var(--bg-height, 100%);
		/* translateX to center horizontally, rotate around the top center so top stays aligned */
		transform: translateX(-50%) translateY(-50%) rotate(var(--bg-rotation, 0deg));
		transform-origin: center center;

		background-image: var(--bg-image);

		/* keep the full illustration card visible (no cropping) while fitting inside the enlarged pseudo-element */
		background-size: var(--bg-size, cover);
		/* background-position-x: var(--bg-positionx, center); */
		/* background-position-y: var(--bg-positiony, center); */
		background-repeat: var(--bg-repeat, no-repeat);
		background-clip: var(--bg-clip, content-box);
		background-origin: var(--bg-origin, border-box);
		z-index: 4;
		pointer-events: none;
	}

	.bg-rotated::before {
		/* top: var(--bg-top, 50%); */
		/* left: var(--bg-left, 0); */
		left: 0;
		/* right: var(--bg-right, 0%); */
		background-image: var(--bg-image-left, var(--bg-image));
		/* On utilise la variable de position avec un fallback à 50% */
		background-position: var(--pos-left, 50%) center;
		/* border-right: 1px solid rgba(255, 255, 255, 0.5); */
	}

	.bg-rotated::after {
		/* top: var(--bg-top, 50%); */
		/* left: var(--bg-left, 0%); */
		/* right: var(--bg-right, 0%); */
		right: 0;
		background: green; /* fallback color if the image fails to load */
		background-image: var(--bg-image-right, var(--bg-image));
		/* On utilise la variable de position avec un fallback à 50% */
		background-position: var(--pos-right, 50%) center;
	}

	/* Overlay qui apparaît au-dessus du background (non interactif) */
	.bg-rotated-overlay {
		position: absolute;
		inset: 0;
		/* below the content (which uses z-index:10) but above the background pseudo-element (z-index:0) */
		z-index: 5;
		pointer-events: none;
		opacity: 0.06;
		transition:
			opacity 120ms ease,
			background-color 120ms ease;
		/* couleur par défaut d'accentuation (peut être surchargée via variable) */
		background: linear-gradient(rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.06));
	}

	/* Prevent default mobile tap highlight (white flash) inside rotated backgrounds */
	.bg-rotated,
	.bg-rotated * {
		-webkit-tap-highlight-color: transparent;
		-webkit-touch-callout: none;
		-touch-action: manipulation;
	}

	/* Make active state on buttons inside player not full white */
	.bg-rotated button:active .plus {
		background-color: rgba(0, 255, 0, 0.65) !important;
	}
	.bg-rotated button:active .minus {
		background-color: rgba(255, 0, 0, 0.65) !important;
	}

	/* Keep the active background while JS marks the button as held */
	.bg-rotated button.holding .plus {
		background-color: rgba(0, 255, 0, 0.65) !important;
	}
	.bg-rotated button.holding .minus {
		background-color: rgba(255, 0, 0, 0.65) !important;
	}

	/* overlay moins opaque (0.70) lorsqu'on met en avant */
	.bg-rotated-overlay.highlight {
		opacity: 0.7;
	}

	/* état mort : overlay sombre mais avec opacité 0.7 */
	.bg-rotated-overlay.dead {
		background: rgba(0, 0, 0, 0.5);
		opacity: 0.7;
	}

	/* Assurer que le contenu reste au-dessus du background */
	.bg-rotated > * {
		position: relative;
		z-index: 10;
	}

	.vert {
		writing-mode: vertical-rl;
	}

	.vert-left {
		writing-mode: vertical-rl;
	}

	.vert-right {
		writing-mode: vertical-lr;
	}

	/* Disable long-press and dragging on elements with the no-longpress class */
	.no-longpress,
	.no-longpress img,
	.no-longpress svg {
		-webkit-user-drag: none;
		user-drag: none;
		-webkit-touch-callout: none; /* iOS */
		-webkit-user-select: none;
		user-select: none;
		touch-action: manipulation;
	}

	/* The dice-rolling animation is a simple rotation with some scaling to give a dynamic effect. */
	@keyframes dice-rotate {
		0% { transform: rotate(0deg) scale(1); }
		25% { transform: rotate(40deg) scale(1.05); }
		50% { transform: rotate(-40deg) scale(0.93); }
		75% { transform: rotate(20deg) scale(1.05); }
		100% { transform: rotate(0deg) scale(1); }
	}
	.dice-rolling {
		display: inline-block;
		animation-name: dice-rotate;
		animation-timing-function: ease-in-out;
		animation-duration: var(--dice-rolling-duration, 2000ms);
	}
	@keyframes final-pop {
		0% { transform: scale(0.96); }
		60% { transform: scale(1.08); }
		100% { transform: scale(1); }
	}
	.dice-final {
		color: #ffd700 !important;
		text-shadow: 0 0 10px rgba(255,215,0,0.9) !important;
		animation: final-pop 260ms ease forwards;
		transition: color 200ms ease, text-shadow 200ms ease;
	}

	/* The animation for the turn counter badge */
	.turn-badge.animate {
		animation: turnPulse 2s ease;
		font-weight: bold;
	}

	@keyframes turnPulse {
		0% {
			transform: rotate(0deg) scale(1);
			filter: brightness(1);
		}
		10% {
			transform: rotate(30deg) scale(1.12);
			color: gold;
			filter: brightness(1.5);
		}
		60% {
			transform: rotate(-30deg) scale(1.05);
			color: gold;
			font-weight: bolder;
			filter: brightness(1.1);
		}
		100% {
			transform: rotate(0deg) scale(1);
			filter: brightness(1);
		}
	}
}

@theme {
	--color-regal-blue: #243c5a;
	--color-white: #ffffff;
}

@layer utilities {
	/* Chrome, Safari and Opera */
	.scrollbar-hidden::-webkit-scrollbar {
		display: none;
	}

	.scrollbar-hidden {
		scrollbar-width: none; /* Firefox */
		-ms-overflow-style: none; /* IE and Edge */
	}
}
